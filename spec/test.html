<!DOCTYPE HTML>
<html>

  <head>
    <title>test</title>

    <script src="jaabro.js"></script>
    <script src="../src/saintmarc.js"></script>
    <!--script src="helpers.js"></script-->

    <!--link
      rel="stylesheet"
      href="https://meyerweb.com/eric/tools/css/reset/reset.css"
      type="text/css" /-->
    <style>
      pre {
        border: 1px solid black;
        height: 14em;
        padding: 3px;
        white-space: pre-wrap;
        word-break: break-word;
      }
      #tree, #debug-tree {
        font-size: 84%;
        font-family: monospace;
        width: 63em;
      }
      .jaabro-children {
        padding-left: 1em;
      }
      .jaabro-tree {
        /*
        width: fit-content;
        */
        border-top: 1px solid lightgrey;
      }
      .jaabro-summary:hover { background-color: lightgreen; }
      .jaabro-failure > .jaabro-summary:hover { background-color: #ff8888; }
      .jaabro-success {
        border-left: 2px solid lightgreen;
      }
      .jaabro-failure {
        border-left: 2px solid red;
      }
      .jaabro-name {
        cursor: pointer;
      }
      .jaabro-children-count {
        cursor: pointer;
      }
      .jaabro-summary > span {
        padding-left: 0.35em;
      }
      /*.jaabro-summary > .jaabro-at { display: none; }*/
      .jaabro-summary > .jaabro-name:not(.jaabro-no-name) {
        font-weight: bold;
      }
      span.jaabro-match { float: right; }
      span.jaabro-string { background-color: lightgreen; }
      span.jaabro-post-string { background-color: lightgrey; }
      .jaabro-failed-children-count {
        padding-left: 0.35em;
      }
      .jaabro-parser {
        padding-left: 0.35em;
        opacity: 0.5;
      }
    </style>
  </head>

  <body>

    <h1>saintmarc</h1>

    <h2>out:</h2>
    <pre id="out"></pre>
    <!--
    <h2>tree:</h2>
    <div id="tree"></div>
    -->
    <h2>debug-tree:</h2>
    <div id="debug-tree"></div>

    <script>

      var clog = console.log;

      var elt = function(sel) { return document.querySelector(sel); };
      var elts = function(sel) { return document.querySelectorAll(sel); };

      var removeAll = function(sel) {
        elts(sel)
          .forEach(function(e) { e.parentElement.removeChild(e); });
        return undefined;
      };

      var on = function(sel, evName, evHandler) {
        elts(sel)
          .forEach(function(e) { e.addEventListener(evName, evHandler); });
        return undefined;
      };

      var s =
        //'This is our test\n' +
        //'It stinks.\n' +
        //'\n' +
        //'This is another paragraph\n' +
        //'\n' +
        //'---\n' +
        //'\n' +
        //'**strong**\n' +
        //'__strong2__\n' +
        //'_emphasis_\n' +
        //'~~strikethrough~~\n' +
        //'click [here](http://example.com/link)!\n' +
        //'this is ~~striken through~~, _gosh_\n' +
        //'\n' +
        //'* Oh rage\n' +
        //'- Oh despair\n' +
        //'\n' +
        '**multiplication** 1 * 2 * 3\n'

      // #out
      //
      var o = SaintMarc.parse(s);
      elt('#out').textContent = JSON.stringify(o);

      // #debug-tree
      //
      var t = SaintMarc.parse(s, { debug: 3 });
      clog(t);
      removeAll('#debug-tree > div');
      elt('#debug-tree').appendChild(t.toHtml());

      elts('.jaabro-extra')
        .forEach(function(e) { e.style.display = 'none'; });
      elts('.jaabro-failure')
        .forEach(function(e) { e.style.display = 'none'; });
      try {
        elt('#debug-tree > .jaabro-failure').style.display = null;
      } catch(e) {}

      on('.jaabro-name', 'click', function(ev) {
        var t = ev.target.closest('.jaabro-tree');
        var ex = t.querySelector('.jaabro-extra');
        ex.style.display = ex.style.display === 'none' ? null : 'none';
      });

      on('.jaabro-children-count', 'click', function(ev) {
        var t = ev.target.closest('.jaabro-tree');
        var fs = t.querySelectorAll(':scope > .jaabro-children > .jaabro-failure');
        var d = (fs[0] && fs[0].style.display === 'none') ? null : 'none';
        fs.forEach(function(f) { f.style.display = d; });
      });
    </script>

  </body>
</html>

